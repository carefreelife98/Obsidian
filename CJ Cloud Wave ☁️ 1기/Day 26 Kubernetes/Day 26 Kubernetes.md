  

## [연습문제] Wordpress + MySQL 구성하기

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_9.28.19.png]]

  

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_10.07.32.png]]

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_10.07.40.png]]

  

  

  

## Helm Chart

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_12.04.50.png]]

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_12.08.48.png]]

- Kubernetes 를 구축하기 위한 수많은 Yaml 파일에 변수를 설정하고, 해당 변수들을 정의 / 선언 / 설정 해놓은 차트이다.

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_12.08.56.png]]

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_10.33.17.png]]

- docker swarm / docker compose 와 비슷함.
- helm 은 cluster 가 아닌 namespace 기준이다.

  

  

```
$ helm create (원하는 차트 이름)
```

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_11.12.09.png]]

  

  

## GIT 사용하기

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_12.23.30.png]]

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_12.23.50.png]]

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_12.26.26.png]]

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_12.26.54.png]]

  

  

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_2.13.51.png]]

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_2.22.01.png]]

  

  

  

## Istio 란?

**Programmable, application-aware network**

- **Istio는 서비스 메쉬**
    - 서비스 메쉬는 쿠버네티스 클러스터에 함께 적용 할 수 있는 소프트웨어.
    - **어플리케이션 트래픽을 인지하고 트래픽을 Programmable하게 관리 하는 도구.**

  

- Envoy proxy = Istio

  

- Istio를 설치하면 내가 서비스를 띄울때 무조건 컨테이너가 추가적으로 하나가 더 뜬다.

  

- Label에 Istio=enabled 되어있는 Name Space를 찾아 컨테이너(Side car)를 하나 더 띄워 준다.

  

## Istio의 중요 기능

1. 트래픽 관리 (Programmable)
    - Circuit Breaker 기능도 수행 가능.
2. 관찰 기능
    - 우리가 띄운 모든 Pod의 트래픽을 볼 수 있다
        - 각 서비스들의 상호 의존성을 한 눈에 볼 수 있게 된다.
3. 보안기능

  

## 동작 원리

- yaml 파일을 해석해서 envoy 설정으로 바꾸어 설정해준다?
- 모든 서비스는 Istio를 거치기 때문에 중요함.
    - repo, ns 전부 따로 만들어 관리.

## Istio 설치

  

Istio 의 Plugin

Kiali

- prometheus
    - Metric을 담당
- Grafana
    - Visualization (Monitoring)
- Jeager
    - Trace (distributed)

  

  

## Istio 사용하기

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.24.37.png]]

```
$ curl
```

  

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.25.12.png]]

  

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.26.17.png]]

  

  

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.26.53.png]]

  

  

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.27.22.png]]

  

  

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.27.44.png]]

  

  

  

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.28.23.png]]

  

  

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.28.53.png]]

  

  

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.30.05.png]]

  

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.34.06.png]]

- Bookinfo

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_3.35.11.png]]

  

  

## Circuit Breaker

1. fortio 와 서비스 사이의 동시 접속 건수가 몇개 이상이 되면 break(차단).
    
      
    
      
    
      
    
      
    
2. 대기 중인 큐 개수가 몇개 이상이면 break(차단).
    
      
    
      
    
3. 500 대의 서버 에러 몇번 발생 시 break(차단).

  

  

  

  

  

# CI / CD

  

CD

- Continuous Delivery
    - Trigger 가 필요함
- Continuous Deployment
    - 완전 자동

  

## CI (Jenkins, Tek-ton, Github, Git Lab)

개발자들이 소스코드 개발

🔽

push

🔽

Git

🔽

merge

🔽

### Pipeline

1. **Artifact**
    - 많은 개발자가 Pull Request 하여 합쳐 나온 산출물
2. image build
    
    - container 생성됨
    
    🔽
    
3. push
    
    🔽
    
4. img Registry 등록

  

  

## CD (ArgoCD)

ArgoCD

- CI 에서 소스가 바뀌어서 매번 merge 될 때마다 서버가 내려갔다 올라가며 반영하는 것은 비효율적.
- ArgoCD 는
    
    Git Pipeline이 가동 될 때마다 yaml 파일의 image: 부분 버전이 바뀌었는지 확인하고 바뀌었으면 해당 이미지를 끌어온 후 서버에 반영.
    
      
    
      
    
      
    
      
    

## app.js 사용하여 CI / CD 적용해보기

  

1. ArgoCD 설치
    
    ![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.28.32.png]]
    
    ```
    $ brew install argocd
    ```
    

  

2. ArgoCD 비밀번호 찾기

```
$ argocd admin initial-password -n argocd
```

- 위 명령어를 사용하면 비밀번호가 나오는데, 복사해놓자.

  

1. Port-Forwarding (Cloud의 로드밸런서가 없으므로 local에서 동작시키기위해)
    
    ![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.42.53.png]]
    
      
    
2. 로컬호스트에서 확인해보자.
    
    ![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.49.21.png]]
    
      
    
3. git 설정
    
    ![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.54.33.png]]
    
      
    
      
    
4. docker img registry 에 image push
    
    ![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-21_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_5.55.00.png]]