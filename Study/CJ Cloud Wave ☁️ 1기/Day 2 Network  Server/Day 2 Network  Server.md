## Cisco Packet Tracer

- 라우팅, subnetting 등을 시뮬레이션 할 수 있는 시뮬레이터.

1. ip를 잘못 부여하면 같은 (동일) 네트워크더라도 통신이 되지 않는 것을 확인할 수 있다.
2. L3 장비는 무조건 서로 다른 네트워크가 연결되어야 한다. 동일 네트워크가 들어가면 안됨.

  

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-27_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_9.30.47.png]]

- 위와 같은 경우, PC 0,1 과 PC2는 다른 네트워크 이므로 통신이 되지 않는다.

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-27_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_9.34.11.png]]

- 라우터에 PC 0, 1이 사용하는 192 대역의 네트워크 주소를 설정해준다.

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-27_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_9.34.30.png]]

- 라우터에 PC 2가 사용하는 10 대역의 네트워크 주소를 설정하여 두 네트워크를 연결해준다.

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-27_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_9.37.58.png]]

**gateway 주소 설정**

- gateway를 정확하게 설정해주지 않으면, 한 서비스에서 다른 서비스로(외부) 로 통신이 불가하다.

  

10.0.0.0 의 경우, 동일한 네트워크 내에서 사용할 수 있는 네트워크의 경우의 수는 2^24 약 1600만개 이나, 동일 에트워크 내에서 이렇게 많은 네트워크를 사용하지 않으므로 subneting을 통해 네트워크를 분할하여 사용해야 한다.

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-27_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_9.48.28.png]]

- 위와 같이 routing table에 두 네트워크의 정보가 존재하므로 서로 다른 두 네트워크의 통신이 가능해진다

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-27_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_9.50.42.png]]

- switch의 경우 layer3의 ip주소는 알지 못하는 것을 볼 수 있다.

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-27_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_9.51.46.png]]

- 하지만, router의 경우 layer3 의 정보인 ip 주소까지 알고 있는것을 볼 수 있다.

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-27_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_9.57.20.png]]

- 서버를 설치한 후 동작 과정을 살펴보면, 10.0.0.100의 서버 ip에서 사용자의 ip주소인 192.168.200.10으로 데이터를 잘 보내는 것을 확인 할 수 있다.

  

## 두번째 시간

  

IPv4 : x.x.x.x

0.0.0.0 : 모든 네트워크

255.255.255.255 : 브로드 캐스트

  

A class(1~126대역) 과 B class(128~191대역) 는 서브 네트워크 (subneting) 을 사용한다.

- /8 인 경우 하나의 네트워크이다.
- /16의 경우 2^8 (0~255) 개의 서로 다른 네트워크 생성의 경우의 수가 생긴다.
    - → subneting

  

VPC의 경우도 서브넷을 분할하여 사용해야 한다.

- 172.16.0.0/24
- 172.16.1.0/24
- 172.16.2.0/24
- 위와 같이 0~255 까지의 2^8 개의 식별 가능한 네트워크를 서브네팅하여 생성할 수 있다.

  

모든 네트워크가 하나의 네트워크를 사용하여 오직 스위치 만을 사용하여 통신 할 수도 없을 뿐더러, 구분없이 모든 네트워크가 서로 통신이 가능하면 안되기 때문에 넷마스크를 사용하여 네트워크를 구분한 것.

  

따라서, 서브네팅이란, ip주소의 네트워크 주소를 나타내는 비트수(넷 마스크)를 증가시켜감으로서 네트워크를 구분하여 분할하는 것이다.

  

추가적으로 /17 등과 같이 하나의 비트를 사용하여 더 세분화 할 수도 있으나, 보통 A,B,C 클래스와 같은 /8, /16, /24 세가지를 사용하여 구분한다.

  

서브네팅 시 기준 주소인 네트워크 주소(첫 주소: ex.172.16.0.0/24 )와 브로드 캐스트 주소(끝 주소: 172.16.1.255/24)는 할당되지 않는다.

- 네트워크 주소: 호스트 비트가 모두 0인 것.
- 브로드 캐스트 주소: 호스트 비트가 모두 1인 것. 시스템 내의 모든 호스트에게 데이터를 보낼 때 사용한다.

  

서로 다른 두 네트워크를 하나로 합칠 수도 있다.

- 172.16.0.0/24
- 172.16.1.0/24
- 위 두 주소가 다른 이유는 0과 1이 다름이다.
- 00000000 과 00000001 의 차이이므로 하나의 비트를 줄여서,
- 0000000 과 0000000 의 비트로 넷마스크를 분할 하도록 변경한다면 두 네트워크를 합칠 수 있게 되고, 그 결과는 아래와 같다.
- 172.16.0.0/23
- 172.16.1.0/23

  

CIDR 을 통해 prefix를 이용하여 네트워크를 표시할 수 있게 됨으로서 A,B,C 클래스의 개념을 없애고, 그로 인해 네트워크를 쉽게 하나로 합칠 수 있게 되었다.

- 192.168.0.0/24 를 후미의 prefix만 /16으로 변경하여 (192.168.0.0/16) 서로 다른 네트워크 (최대 256개) 를 하나의 네트워크로 합칠 수 있게 된다.

  

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-27_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_10.56.42.png]]

- 정적 주소(static) 설정 : 해당 네트워크로 패킷이오면 전부 nexthop으로 보내라.
- 정적 주소(static) 를 사용하여 관리자가 직접 경로를 설정 할 수 있다.

  

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-27_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_11.20.03.png]]

- 위와 같이 새로운 라우터를 추가하여 두 라우터를 연결 후,

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-27_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_11.23.24.png]]

- 양쪽의 네트워크 주소를 각 라우터에 연결하여 라우터를 추가 할 수 있다.
- 이와 같은 경우, 각 라우터는 반대쪽의 네트워크를 모르게 된다.
- static 주소 설정을 통해 반대쪽 네트워크의 정보를 각 라우터에 설정 할 수 있다.

  

**동적 주소 설정(RIP)**

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-27_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_11.32.03.png]]

- RIP 를 사용하여 동적 주소 설정: 반대쪽 네트워크의 ip주소를 라우터0에 알려주고 해당 네트워크와 연결되어 있어 서로 메세지를 교환할 라우터1 과의 연결된 네트워크 정보도 설정해준다.
    - (위 부분은 복습 결과 약간의 오류가 있는 메모인듯?)

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-27_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_11.33.27.png]]

- 위와 같이 라우터 0에 반대쪽 네트워크인 10.0.0.0 ip주소가 저장된 것을 볼 수 있다.

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-27_%E1%84%8B%E1%85%A9%E1%84%8C%E1%85%A5%E1%86%AB_11.33.59.png]]

- 마찬가지로, 라우터1에도 반대쪽 네트워크인 192.168.200.0이 들어와 있는 것을 볼 수 있다.

  

BGP : AS 간의 통신을 위함. 조직 간의 통신

AS 번호 : 한 조직에서 관리하는 라우터 집단의 번호. IP주소처럼 고유한 숫자이다.

  

정리

1. 라우팅 정보란?
2. 라우팅 설정 하는 방법

- 정적
- 동적

1. BGP 란?

  

# 세번째 시간

  

- 외부 네트워크는 사설 네트워크의 정보를 알 수 없다.
- NAT(Network Address Translation) : 출발지 IP주소를 공인 IP 주소로 변경하는 기술.
- 사설망 쪽이 inside , 공용망 쪽이 outside

  

**NAT 설정하기**

1. Router(config-router)\#access-list 1 permit 192.168.200.0 0.0.0.255
2. Router(config)\#ip nat inside source list 1 int
3. Router(config)\#ip nat inside source list 1 int g0/0
4. Router(config)\#int g0/0
5. Router(config-if)\#ip nat outside

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-07-09_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_9.11.44.png]]

**NAT(Network Address Translation)을 사설 / 공중망을 잇는 라우터에 적용하게 되면 비로소 사설망과 공중망간의 통신이 이루어지게 된다.**

- 사설망과 공중망을 잇는 라우터에서 출발지인 사설망 IP주소를 목적지 공중망 IP 주소로 변경해주는 것이 NAT 기술.
- 공중망을 통해 사설망 내부 디바이스로의 접근도 가능하나, 보안상의 이유로 사용하지 않음.

  

## AWS

private 주소: 내부끼리 통신할때만 사용

  

VPC-1(Public)

- Subnet-2
    - EC2(Bastion host)

VPC-2(Private)

- Subnet-3
    - EC2

  

**Private인 VPC-2에 접속하기 위해서는 Public인 VPC-1을 통해야만 한다.**

  

**VPC-2의 EC2가 외부 통신을 하기 위해서 NAT Gateway를 이용한다.**

  

VPC 간에는 서로 통신이 되지 않는다.

- peering 연결(1대 1 연결)을 통해 VPC를 연결 할 수 있다.
- private VPC 인스턴스의 보안 탭 → 보안 그룹(방화벽)
- 인바운드 규칙 편집(ssh만 접근 가능하도록 되어 있는 것에 새로운 규칙을 추가하여 다른 VPC를 연결할 수 있도록 해준다.)

  

  

**Private VPC 접속하기**

1. terminal에서 key가 있는 폴더로 이동.
2. ssh -i csm-keypair.pem ec2-user@3.35.231.141 명령어를 사용. @이후에는 public IPv4주소이다.(AWS 홈페이지의 해당 인스턴스를 보면 존재)

  

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-27_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.33.36.png]]

- MacOs의 경우 위와 같은 오류 발생 시
    
    $ chmod 600 (key file 이름).pem 을 통해 pem 키 파일의 권한을 변경해주어야 한다.
    

  

1. 보안 규칙 추가하여 VPC 간의 peering 실시.
2. 아래와 같은 연결 대상 VPC의 라우팅 테이블로 이동하여 VPC 1 과 VPC 2 의 대상 주소 정보를 양 쪽 테이블에 추가하여 알려준다.

![[%E1%84%89%E1%85%B3%E1%84%8F%E1%85%B3%E1%84%85%E1%85%B5%E1%86%AB%E1%84%89%E1%85%A3%E1%86%BA_2023-06-27_%E1%84%8B%E1%85%A9%E1%84%92%E1%85%AE_4.44.39.png]]

1. peering 된 추가 대상 (VPC 2)의 Private IP DNS 이름으로 ping을 보내 VPC 1을 통해 VPC 2 로 접근이 되는지 확인한다.

  

**문제**

VPC-1(Public)

- 공개 키
- 복사된 개인키
- Subnet-2
    - EC2(Bastion host)

  

컴퓨터(개인키)

  

VPC-2(Private)

- 공개 키
- Subnet-3
    
    - EC2
    
      
    

개인 키를 VPC-1에 보내 인증하고 VPC-2에 연결할 수 있게 된다.

따라서 VPC-2 로의 직접 연결이 어렵게 되는데,

Secure Copy 명령어인 scp 를 통해 개인키를 VPC-1에 복사한 후,

  

1. NAT Gateway 생성 후 Private VPC의 네트워크 → 서브넷 → 라우팅 테이블 / 편집(외부로 나갈 수 있는 정보가 없음) 에 외부로 나갈 수 있는 NAT Gateway와 해당 외부 주소를 저장해준다.

  

탄력적 IP는 고정 IP 이기 때문에 사용하지 않더라도 다른 회사에서 사용하지 못하기 때문에 비용 발생.

- 따라서 사용하지 않는 탄력 IP는 해제 시켜주어야 함.

  

TTL : 대게 64 / 128 을 근접한 값을 기준으로 모자란 수만큼의 라우터를 거친 것.

  

**중요 부분**

EC-2 접속 하는 방법 → ssh 사용법 잘 숙지하기.

scp 통해서 키 복사하는 법 잘 숙지하기.